{% extends "base.html" %}

{% block title %}Register - Hand Gesture Recognition{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 450px;">
  <h2 class="mb-4 text-center">Register</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div>
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" action="{{ url_for('register') }}" novalidate>
    <div class="mb-3">
      <label for="full_name" class="form-label">Full Name</label>
      <input type="text" class="form-control" id="full_name" name="full_name" required autofocus>
      <div class="invalid-feedback">
        Please enter your full name.
      </div>
    </div>

    <div class="mb-3">
      <label for="email" class="form-label">Email address</label>
      <input type="email" class="form-control" id="email" name="email" required>
      <div class="invalid-feedback">
        Please enter a valid email address.
      </div>
    </div>

    <div class="mb-3">
      <label for="password" class="form-label">Password</label>
      <div class="position-relative">
        <input type="password" class="form-control" id="password" name="password" minlength="6" required style="padding-right: 60px;">
        <button type="button" class="btn btn-link position-absolute" id="togglePassword" onclick="togglePasswordVisibility('password', this)" style="top: 50%; right: 5px; transform: translateY(-50%); text-decoration: none; color: #6c757d; font-size: 0.875rem; padding: 0.25rem 0.5rem;">
          Show
        </button>
      </div>
      <div class="invalid-feedback">
        Password must be at least 6 characters.
      </div>
    </div>

    <div class="mb-3">
      <label for="confirm" class="form-label">Confirm Password</label>
      <div class="position-relative">
        <input type="password" class="form-control" id="confirm" name="confirm" minlength="6" required style="padding-right: 60px;">
        <button type="button" class="btn btn-link position-absolute" id="toggleConfirm" onclick="togglePasswordVisibility('confirm', this)" style="top: 50%; right: 5px; transform: translateY(-50%); text-decoration: none; color: #6c757d; font-size: 0.875rem; padding: 0.25rem 0.5rem;">
          Show
        </button>
      </div>
      <div class="invalid-feedback" id="confirm-feedback">
        Please confirm your password.
      </div>
    </div>

    <button type="submit" class="btn btn-success w-100">Register</button>
  </form>

  <p class="mt-3 text-center">Already have an account? <a href="{{ url_for('login') }}">Login here</a></p>
</div>

<script>
  (() => {
    'use strict';

    const form = document.querySelector('form');

    form.addEventListener('submit', event => {
      const pwd = form.password.value;
      const confirmPwd = form.confirm.value;
      const confirmFeedback = document.getElementById('confirm-feedback');

      if (pwd !== confirmPwd) {
        event.preventDefault();
        event.stopPropagation();
        confirmFeedback.textContent = 'Passwords do not match.';
        form.confirm.setCustomValidity('Passwords do not match');
        form.classList.add('was-validated');
      } else {
        form.confirm.setCustomValidity('');
      }

      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }

      form.classList.add('was-validated');
    }, false);
  })();

  function togglePasswordVisibility(fieldId, btn) {
    const pwdInput = document.getElementById(fieldId);
    if (pwdInput.type === 'password') {
      pwdInput.type = 'text';
      btn.textContent = 'Hide';
    } else {
      pwdInput.type = 'password';
      btn.textContent = 'Show';
    }
  }
</script>
{% endblock %}
