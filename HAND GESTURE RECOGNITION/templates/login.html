{% extends "base.html" %}

{% block title %}Login - Hand Gesture Recognition{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 400px;">
  <h2 class="mb-4 text-center">Login</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div>
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" action="{{ url_for('login') }}" novalidate>
    <div class="mb-3">
      <label for="email" class="form-label">Email address</label>
      <input type="email" class="form-control" id="email" name="email" required autofocus>
      <div class="invalid-feedback">
        Please enter a valid email address.
      </div>
    </div>

    <div class="mb-3">
      <label for="password" class="form-label">Password</label>
      <div class="position-relative">
        <input type="password" class="form-control password-input" id="password" name="password" required>
        <button type="button" class="btn btn-link position-absolute" id="togglePassword" onclick="togglePasswordVisibility()" style="top: 50%; right: 5px; transform: translateY(-50%); text-decoration: none; color: #6c757d; font-size: 0.875rem; padding: 0.25rem 0.5rem; z-index: 10;">
          Show
        </button>
      </div>
      <div class="invalid-feedback">
        Please enter your password.
      </div>
    </div>

    <button type="submit" class="btn btn-primary w-100">Login</button>
  </form>

  <p class="mt-3 text-center">Don't have an account? <a href="{{ url_for('register') }}">Register here</a></p>
</div>

<style>
  /* Custom styling for password input to accommodate both validation icon and show/hide button */
  .password-input {
    padding-right: 80px !important;
  }
  
  /* Hide the default Bootstrap validation icons for password field */
  .was-validated .password-input:valid {
    background-image: none;
    padding-right: 80px !important;
  }
  
  .was-validated .password-input:invalid {
    background-image: none;
    padding-right: 80px !important;
  }
</style>

<script>
  // Bootstrap 5 client-side validation
  (() => {
    'use strict';
    const forms = document.querySelectorAll('form');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false)
    });
  })();

  function togglePasswordVisibility() {
    const pwdInput = document.getElementById('password');
    const btn = document.getElementById('togglePassword');
    if (pwdInput.type === 'password') {
      pwdInput.type = 'text';
      btn.textContent = 'Hide';
    } else {
      pwdInput.type = 'password';
      btn.textContent = 'Show';
    }
  }
</script>
{% endblock %}
